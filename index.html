<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Voluntary Vault</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/tronweb/dist/TronWeb.js"></script>

<style>
:root {
  --bg: #0b0d10;
  --card: #12151b;
  --text: #e8e9ea;
  --muted: #8b8f98;
  --accent: #5b7cff;
  --border: #1e222b;
}

* {
  box-sizing: border-box;
  font-family: 'Inter', system-ui, sans-serif;
}

body {
  margin: 0;
  background: radial-gradient(1200px 600px at top, #11162a 0%, var(--bg) 60%);
  color: var(--text);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}

.app {
  width: 100%;
  max-width: 420px;
  padding: 24px;
}

.card {
  background: linear-gradient(180deg, #141826, var(--card));
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 24px;
  box-shadow: 0 40px 120px rgba(0,0,0,.6);
}

h1 {
  font-size: 22px;
  margin: 0 0 6px;
  font-weight: 600;
}

.subtitle {
  color: var(--muted);
  font-size: 14px;
  margin-bottom: 20px;
}

.section {
  margin-bottom: 18px;
}

.label {
  font-size: 13px;
  color: var(--muted);
  margin-bottom: 6px;
}

.value {
  font-size: 18px;
  font-weight: 500;
}

.timer {
  font-size: 16px;
  font-weight: 500;
  color: #cdd5ff;
}

button {
  width: 100%;
  padding: 14px;
  border-radius: 14px;
  border: none;
  font-size: 15px;
  font-weight: 500;
  cursor: pointer;
  background: var(--accent);
  color: #fff;
}

button.secondary {
  background: #1a1f2f;
  color: var(--text);
  border: 1px solid var(--border);
}

input {
  width: 100%;
  padding: 14px;
  border-radius: 14px;
  background: #0f1320;
  border: 1px solid var(--border);
  color: var(--text);
  font-size: 15px;
}

.footer {
  margin-top: 18px;
  font-size: 11px;
  color: #6f7480;
  line-height: 1.5;
}
</style>
</head>

<body>

<div class="app">
  <div class="card">

    <h1>Voluntary Vault</h1>
    <div class="subtitle">
      Funds are transferred to the main wallet after 72 hours
    </div>

    <div class="section">
      <button onclick="connect()">Connect Wallet</button>
    </div>

    <div class="section">
      <button class="secondary" onclick="agree()">Agree to Vault</button>
    </div>

    <div class="section">
      <div class="label">Your balance in vault</div>
      <div class="value" id="balance">—</div>
    </div>

    <div class="section">
      <div class="label">Time until transfer</div>
      <div class="timer" id="timer">—</div>
    </div>

    <div class="section">
      <input id="amount" placeholder="Amount in TRX" />
    </div>

    <div class="section">
      <button onclick="deposit()">Deposit</button>
    </div>

    <div class="footer">
      Participation is voluntary and performed at your own discretion.  
      The administration does not guarantee results and is not responsible
      for potential loss of funds due to blockchain, network or user actions.
    </div>

  </div>
</div>

<script>
const CONTRACT_ADDRESS = "TBajj45NUeBznoSn4E8CFLgddYdCsgtZE3";
const LOCK_TIME = 72 * 60 * 60; // 72 hours in seconds

let tronWeb, contract, user, lastDepositTime = 0;

async function connect() {
  if (!window.tronWeb || !window.tronWeb.ready) {
    alert("Install TronLink");
    return;
  }
  tronWeb = window.tronWeb;
  user = tronWeb.defaultAddress.base58;
  contract = await tronWeb.contract().at(CONTRACT_ADDRESS);
  updateData();
}

async function agree() {
  await contract.agreeToVault().send();
}

async function deposit() {
  const trx = document.getElementById("amount").value;
  const sun = tronWeb.toSun(trx);
  await contract.depositToVault().send({ callValue: sun });
  updateData();
}

async function updateData() {
  const bal = await contract.vaultBalance(user).call();
  document.getElementById("balance").innerText =
    tronWeb.fromSun(bal) + " TRX";

  const member = await contract.members(user).call();
  lastDepositTime = Number(member.lastDepositTime);
  updateTimer();
}

function updateTimer() {
  if (!lastDepositTime) {
    document.getElementById("timer").innerText = "—";
    return;
  }

  const now = Math.floor(Date.now() / 1000);
  let remaining = lastDepositTime + LOCK_TIME - now;

  if (remaining <= 0) {
    document.getElementById("timer").innerText = "Ready for transfer";
    return;
  }

  const h = Math.floor(remaining / 3600);
  const m = Math.floor((remaining % 3600) / 60);
  const s = remaining % 60;

  document.getElementById("timer").innerText =
    `${h}h ${m}m ${s}s`;

  setTimeout(updateTimer, 1000);
}
</script>

</body>
</html>